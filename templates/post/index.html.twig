{% extends 'base.html.twig' %}

{% block body %}
    <h1>Toutes les actualités</h1>
    <form method="get">
        <input type="text" name="search" placeholder="Recherche par mot clé" value="{{ app.request.query.get('search') }}">
        <select name="criteria">
            <option value="date" {% if app.request.query.get('criteria') == 'date' %}selected{% endif %}>Date</option>
            <option value="category" {% if app.request.query.get('criteria') == 'category' %}selected{% endif %}>Catégorie</option>
            <option value="likes" {% if app.request.query.get('criteria') == 'likes' %}selected{% endif %}>Likes</option>
            <option value="dislikes" {% if app.request.query.get('criteria') == 'dislikes' %}selected{% endif %}>Dislikes</option>
        </select>
        <select name="order">
            <option value="asc" {% if app.request.query.get('order') == 'asc' %}selected{% endif %}>Ascendant</option>
            <option value="desc" {% if app.request.query.get('order') == 'desc' %}selected{% endif %}>Descendant</option>
        </select>
        <button type="submit">Recherche</button>
    </form>
    <ul>
        {% for post in posts %}
            <li>
                <a href="{{ path('post_show', {'id': post.id}) }}">{{ post.title }}</a>
                <div>
                    <span>{{ post.countLikes() }} likes</span>
                    <span>{{ post.countDislikes() }} dislikes</span>
                </div>
                <p>
                    {% if post.content|length > 500 %}
                        {{ post.content|raw[:500] ~ '...' }}
                    {% else %}
                        {{ post.content|raw }}
                    {% endif %}
                    <a href="{{ path('post_show', {'id': post.id}) }}">lire la suite</a>
                </p>
                {% if is_granted('ROLE_ADMIN') %}
                    <a href="{{ path('admin_post_edit', {'id': post.id}) }}">Modifier</a>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
{% endblock %}